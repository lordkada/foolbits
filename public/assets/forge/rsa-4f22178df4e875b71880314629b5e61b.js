!function(){function e(e){function t(t,n,r){var i=e.util.createBuffer(),a=Math.ceil(n.n.bitLength()/8);if(t.length>a-11)throw{message:"Message is too long for PKCS#1 v1.5 padding.",length:t.length,max:a-11};i.putByte(0),i.putByte(r);var o,s=a-3-t.length;if(0===r||1===r){o=0===r?0:255;for(var u=0;s>u;++u)i.putByte(o)}else for(var u=0;s>u;++u)o=Math.floor(255*Math.random())+1,i.putByte(o);return i.putByte(0),i.putBytes(t),i}function n(t,n,r,i){var a=Math.ceil(n.n.bitLength()/8),o=e.util.createBuffer(t),s=o.getByte(),u=o.getByte();if(0!==s||r&&0!==u&&1!==u||!r&&2!=u||r&&0===u&&"undefined"==typeof i)throw{message:"Encryption block is invalid."};var p=0;if(0===u){p=a-3-i;for(var l=0;p>l;++l)if(0!==o.getByte())throw{message:"Encryption block is invalid."}}else if(1===u)for(p=0;o.length()>1;){if(255!==o.getByte()){--o.read;break}++p}else if(2===u)for(p=0;o.length()>1;){if(0===o.getByte()){--o.read;break}++p}var f=o.getByte();if(0!==f||p!==a-3-o.length())throw{message:"Encryption block is invalid."};return o.getBytes()}function r(t,n,r){function i(){return e.pki.rsa.stepKeyPairGenerationState(t,10)?r(null,t.keys):(e.util.setImmediate(i),void 0)}function a(){o(t.pBits,function(e,n){return e?r(e):(t.p=n,o(t.qBits,s),void 0)})}function o(e,n){function r(){var n=e-1,r=new BigInteger(e,t.rng);return r.testBit(n)||r.bitwiseTo(BigInteger.ONE.shiftLeft(n),g,r),r.dAddOffset(31-r.mod(d).byteValue(),0),r}function i(i){if(!y){--s;var o=i.data;if(o.found){for(var u=0;u<a.length;++u)a[u].terminate();return y=!0,n(null,new BigInteger(o.prime,16))}c.bitLength()>e&&(c=r());var f=c.toString(16);i.target.postMessage({e:t.eInt,hex:f,workLoad:p}),c.dAddOffset(l,0)}}for(var a=[],o=0;u>o;++o)a[o]=new Worker(f);for(var s=u,c=r(),o=0;u>o;++o)a[o].addEventListener("message",i);var y=!1}function s(n,i){if(t.q=i,t.p.compareTo(t.q)<0){var u=t.p;t.p=t.q,t.q=u}if(t.p1=t.p.subtract(BigInteger.ONE),t.q1=t.q.subtract(BigInteger.ONE),t.phi=t.p1.multiply(t.q1),0!==t.phi.gcd(t.e).compareTo(BigInteger.ONE))return t.p=t.q=null,a(),void 0;if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits)return t.q=null,o(t.qBits,s),void 0;var p=t.e.modInverse(t.phi);t.keys={privateKey:e.pki.rsa.setPrivateKey(t.n,t.e,p,t.p,t.q,p.mod(t.p1),p.mod(t.q1),t.q.modInverse(t.p)),publicKey:e.pki.rsa.setPublicKey(t.n,t.e)},r(null,t.keys)}if("function"==typeof n&&(r=n,n={}),"undefined"==typeof Worker)return i();var u=n.workers||2,p=n.workLoad||100,l=30*p/8,f=n.workerScript||"forge/prime.worker.js",d=new BigInteger(null);d.fromInt(30);var g=function(e,t){return e|t};a()}"undefined"==typeof BigInteger&&(BigInteger=e.jsbn.BigInteger);var i=e.asn1;e.pki=e.pki||{},e.pki.rsa=e.rsa=e.rsa||{};var a=e.pki,o=[6,4,2,4,2,4,6,2],s=function(t){var n;if(!(t.algorithm in e.pki.oids))throw{message:"Unknown message digest algorithm.",algorithm:t.algorithm};n=e.pki.oids[t.algorithm];var r=i.oidToDer(n).getBytes(),a=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),o=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);o.value.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,r)),o.value.push(i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,""));var s=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.digest().getBytes());return a.value.push(o),a.value.push(s),i.toDer(a).getBytes()},u=function(e,t,n){var r;if(n)r=e.modPow(t.e,t.n);else{t.dP||(t.dP=t.d.mod(t.p.subtract(BigInteger.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(BigInteger.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));for(var i=e.mod(t.p).modPow(t.dP,t.p),a=e.mod(t.q).modPow(t.dQ,t.q);i.compareTo(a)<0;)i=i.add(t.p);r=i.subtract(a).multiply(t.qInv).mod(t.p).multiply(t.q).add(a)}return r};a.rsa.encrypt=function(n,r,i){var a,o=i,s=Math.ceil(r.n.bitLength()/8);i!==!1&&i!==!0?(o=2===i,a=t(n,r,i)):(a=e.util.createBuffer(),a.putBytes(n));for(var p=new BigInteger(a.toHex(),16),l=u(p,r,o),f=l.toString(16),d=e.util.createBuffer(),g=s-Math.ceil(f.length/2);g>0;)d.putByte(0),--g;return d.putBytes(e.util.hexToBytes(f)),d.getBytes()},a.rsa.decrypt=function(t,r,i,a){var o=Math.ceil(r.n.bitLength()/8);if(t.length!==o)throw{message:"Encrypted message length is invalid.",length:t.length,expected:o};var s=new BigInteger(e.util.createBuffer(t).toHex(),16);if(s.compareTo(r.n)>=0)throw{message:"Encrypted message is invalid."};for(var p=u(s,r,i),l=p.toString(16),f=e.util.createBuffer(),d=o-Math.ceil(l.length/2);d>0;)f.putByte(0),--d;return f.putBytes(e.util.hexToBytes(l)),a!==!1?n(f.getBytes(),r,i):f.getBytes()},a.rsa.createKeyPairGenerationState=function(t,n){"string"==typeof t&&(t=parseInt(t,10)),t=t||1024;var r={nextBytes:function(t){for(var n=e.random.getBytes(t.length),r=0;r<t.length;++r)t[r]=n.charCodeAt(r)}},i={state:0,bits:t,rng:r,eInt:n||65537,e:new BigInteger(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null};return i.e.fromInt(i.eInt),i},a.rsa.stepKeyPairGenerationState=function(t,n){var r=new BigInteger(null);r.fromInt(30);for(var i,a=0,s=function(e,t){return e|t},u=+new Date,p=0;null===t.keys&&(0>=n||n>p);){if(0===t.state){var l=null===t.p?t.pBits:t.qBits,f=l-1;0===t.pqState?(t.num=new BigInteger(l,t.rng),t.num.testBit(f)||t.num.bitwiseTo(BigInteger.ONE.shiftLeft(f),s,t.num),t.num.dAddOffset(31-t.num.mod(r).byteValue(),0),a=0,++t.pqState):1===t.pqState?t.num.bitLength()>l?t.pqState=0:t.num.isProbablePrime(1)?++t.pqState:t.num.dAddOffset(o[a++%8],0):2===t.pqState?t.pqState=0===t.num.subtract(BigInteger.ONE).gcd(t.e).compareTo(BigInteger.ONE)?3:0:3===t.pqState&&(t.pqState=0,t.num.isProbablePrime(10)&&(null===t.p?t.p=t.num:t.q=t.num,null!==t.p&&null!==t.q&&++t.state),t.num=null)}else if(1===t.state)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(2===t.state)t.p1=t.p.subtract(BigInteger.ONE),t.q1=t.q.subtract(BigInteger.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(3===t.state)0===t.phi.gcd(t.e).compareTo(BigInteger.ONE)?++t.state:(t.p=null,t.q=null,t.state=0);else if(4===t.state)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(5===t.state){var d=t.e.modInverse(t.phi);t.keys={privateKey:e.pki.rsa.setPrivateKey(t.n,t.e,d,t.p,t.q,d.mod(t.p1),d.mod(t.q1),t.q.modInverse(t.p)),publicKey:e.pki.rsa.setPublicKey(t.n,t.e)}}i=+new Date,p+=i-u,u=i}return null!==t.keys},a.rsa.generateKeyPair=function(e,t,n,i){1===arguments.length?"object"==typeof e?(n=e,e=void 0):"function"==typeof e&&(i=e,e=void 0):2===arguments.length?("number"==typeof e?"function"==typeof t?i=t:n=t:(n=e,i=t,e=void 0),t=void 0):3===arguments.length&&("number"==typeof t?"function"==typeof n&&(i=n,n=void 0):(i=n,n=t,t=void 0)),n=n||{},void 0===e&&(e=n.bits||1024),void 0===t&&(t=n.e||65537);var o=a.rsa.createKeyPairGenerationState(e,t);return i?(r(o,n,i),void 0):(a.rsa.stepKeyPairGenerationState(o,0),o.keys)},a.rsa.setPublicKey=function(r,o){var s={n:r,e:o};return s.encrypt=function(n,r,i){if("string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===r)r={encode:function(e,n){return t(e,n,2).getBytes()}};else if("RSA-OAEP"===r||"RSAES-OAEP"===r)r={encode:function(t,n){return e.pkcs1.encode_rsa_oaep(n,t,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(r))throw{message:'Unsupported encryption scheme: "'+r+'".'};r={encode:function(e){return e}}}var o=r.encode(n,s,!0);return a.rsa.encrypt(o,s,!0)},s.verify=function(e,t,r){"string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSASSA-PKCS1-V1_5"),"RSASSA-PKCS1-V1_5"===r?r={verify:function(e,t){t=n(t,s,!0);var r=i.fromDer(t);return e===r.value[1].value}}:("NONE"===r||"NULL"===r||null===r)&&(r={verify:function(e,t){return t=n(t,s,!0),e===t}});var o=a.rsa.decrypt(t,s,!0,!1);return r.verify(e,o,s.n.bitLength())},s},a.rsa.setPrivateKey=function(t,r,i,o,u,p,l,f){var d={n:t,e:r,d:i,p:o,q:u,dP:p,dQ:l,qInv:f};return d.decrypt=function(t,r,i){"string"==typeof r?r=r.toUpperCase():void 0===r&&(r="RSAES-PKCS1-V1_5");var o=a.rsa.decrypt(t,d,!1,!1);if("RSAES-PKCS1-V1_5"===r)r={decode:n};else if("RSA-OAEP"===r||"RSAES-OAEP"===r)r={decode:function(t,n){return e.pkcs1.decode_rsa_oaep(n,t,i)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(r))throw{message:'Unsupported encryption scheme: "'+r+'".'};r={decode:function(e){return e}}}return r.decode(o,d,!1)},d.sign=function(e,t){var n=!1;"string"==typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:s},n=1):("NONE"===t||"NULL"===t||null===t)&&(t={encode:function(){return e}},n=1);var r=t.encode(e,d.n.bitLength());return a.rsa.encrypt(r,d,n)},d}}var t="rsa";if("function"!=typeof define){if("object"!=typeof module||!module.exports)return"undefined"==typeof forge&&(forge={}),e(forge);var n=!0;define=function(e,t){t(require,module)}}var r,i=function(n,i){i.exports=function(i){var a=r.map(function(e){return n(e)}).concat(e);if(i=i||{},i.defined=i.defined||{},i.defined[t])return i[t];i.defined[t]=!0;for(var o=0;o<a.length;++o)a[o](i);return i[t]}},a=define;define=function(e,t){return r="string"==typeof e?t.slice(2):e.slice(2),n?(delete define,a.apply(null,Array.prototype.slice.call(arguments,0))):(define=a,define.apply(null,Array.prototype.slice.call(arguments,0)))},define(["require","module","./asn1","./oids","./random","./util","./jsbn","./pkcs1"],function(){i.apply(null,Array.prototype.slice.call(arguments,0))})}();